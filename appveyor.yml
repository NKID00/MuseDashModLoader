version: 1.0.{build}
image: Visual Studio 2019
configuration: Release
platform: Any CPU
build_script:
- ps: >-
    nuget restore

    msbuild IMod /p:Configuration=Release /p:Platform=AnyCPU /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

    msbuild ModLoader /p:Configuration=Release /p:Platform=AnyCPU /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

    msbuild Proxy /p:Configuration=Release /p:Platform=Win32 /verbosity:minimal /logger:"C:\Program Files\AppVeyor\BuildAgent\Appveyor.MSBuildLogger.dll"

after_build:
- ps: >-
    New-Item -Path build\$CONFIGURATION\Mods -Type Directory

    New-Item -Path build\dist\Mods -Type Directory

    Copy-Item load_config.ini -Destination build\$CONFIGURATION

    Copy-Item load_config.ini -Destination build\dist

    Copy-Item build\$CONFIGURATION\*.dll -Destination build\dist

    Copy-Item build\$CONFIGURATION\Mods\*.dll -Destination build\dist\Mods

artifacts:
- path: build\$(configuration)
  name: Debug Release

- path: build\dist
  name: Dist Release